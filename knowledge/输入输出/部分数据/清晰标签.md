大概流程：

1. 通过标签和类别去重找出未在食材树种的标签
2. 将每一个标签放入食材树中，必须为第三等级或者第四等级，尽量以第四等级为主
   - 由于标签间存在相似性，所以可以先聚类或者大概相似的标签，并联合放入树中



我需要做的事情:

**核心就是方便大家将标签放入结构树中**：

1. 做出ui界面，包含有几个要求：
   - 能够可视化树结构，可以点击当前节点进入该节点的下一级树结构
   - 在第三或者第四级树甚至更高级树中，允许用户点击添加节点，将该批节点（1个或者多个）放入该等级中
   - 在第三以及更高级别可视化中，允许用户删除某些节点来进行再次划分
   - 允许用户创建等级。因为树结构不可能涵盖所有标签，虽然可以直接将标签插入当前等级，但是当同类标签较多且与父节点间语义差异较大时，可以允许用户创建节点，并将同类节点放在该节点下
2. 由于标签数量较多，整理标签时间较长，允许中间程序停止，并且保证标签结果保存，以便下一次继续该过程
   - 运行程序中，需定义一个未处理标签字典，随处理过程不断删减对应标签，在结束ui界面后，保存未处理标签并停止程序
3. 由于标签数量较多，每次只放1个标签速率太慢，因此提供多个标签同时处理方式。用户可以选择聚类按钮，对当前所剩标签进行聚类，并在当前页返回聚类结果。用户可以根据聚类推荐相似度高的标签中选择若干个标签进行同时处理。

Figma访问令牌：figd_P1_XOmiyUEaP2pcBdRqAOleT7eW1tuINhHGHVxaI



### 输入要求：

1. **全部ingredient数据、对应的特征**，用于文本聚类，这两个文件不可以更改
2. **待处理的未标记食材**和**已经标记的结构树**（结构树存在默认文件）
3. 保存文件地址：保存**食材数据**和**结构树数据**

### 环境要求：

1. sklearn  用于文本聚类
2. tkinter 用于gui可视化：[ParthJadhav/Tkinter-Designer: An easy and fast way to create a Python GUI 🐍 (github.com)](https://github.com/ParthJadhav/Tkinter-Designer)



### 功能展示

| 功能名称             | 功能作用                                                     |
| -------------------- | ------------------------------------------------------------ |
| 首页                 | 将未标记食材可视化返回首页，展示前64个标签                   |
| 上一页               | 返回当前64个标签的前64个标签，如果当前页为首页，则返回警告   |
| 下一页               | 返回当前64个标签的后64个标签，如果当前页为尾页，则返回警告   |
| 根节点               | 返回已标注结构树的根节点                                     |
| 下一级               | 返回结构树当前级别的下一级节点                               |
| 上一级               | 返回结构树当前级别的上一级节点                               |
| 点击“未标记食材块”   | 将未标记食材存入“标记食材缓存区”                             |
| 点击“结构树叶子节点” | 进入该结构树节点的下一级节点                                 |
| 删除节点缓存区       | 将当前节点的父节点加入“删除节点缓存区”，再次点击删除节点即可删除该节点以及子树。$\textcolor{red}{注意，尽可能不要删除非叶子节点，否则很麻烦，无法撤销操作。删除节点最好仅删除叶子节点}$ |
| 标记节点             | 将“标记食材缓存区”的食材存入结构树当前级别，并在未标记食材区中删除对应食材。$\textcolor{red}{切记，添加多个节点时，必须为结构树同一父节点下，函数会自动调用结构树可视化区域当前节点，作为插入的父节点}$ |
| 删除节点             | 将“删除节点缓存区”中的叶子节点删除，并放入未标记食材区。$\textcolor{red}{删除对应节点后，结构树会默认返回当前节点的上一节点进行可视化}$ |
| 添加新节点           | 一些食材所属类别可能并不在规定类别中，或者认为一些食材应该具有更细致的分类，可以通过添加新节点按钮，在$\textcolor{red}{结构树当前节点下}$新建一个节点 |
| 保存数据             | 实时保存数据                                                 |
| PS                   | 不能直接停止程序，只能通过关掉UI界面来结束程序运行。如果直接停止，则未保存的已经标注部分数据的结构树则不会保存，只有正常关闭，最后程序会自动保存标注好的结构树 |



### 具体流程

1. **多人标注过程**
   - 将2100多个食材按照batchsize=64分成了33个batch，抽出10个人，每人平均3-4个batch的标注。每一个batch的标注大概在2小时左右，主要因为大量的食材都不认识。。
   - batch标注最终的结果有2个文件，一个是标注好的结构树，另一个是未标注的食材（对于食材名称模糊，存在歧义，无法判断的食材可以不标注$\textcolor{red}{或者将其放入到其他类别中}$）
   - 问题：每个人主观程度不一样，是否需要对于食材进行二次甚至多次标注
   - 花费时间：大约1天
2. **标签整理过程**
   - **汇总**2类文件，多人标注过程会出现33个未标注json，以及33个结构树json，通过遍历所有食材名称，汇总成1个未标注json，1个结构树json
   - **整理1--剩余标签**：存在歧义、模糊的标签，需要定位到原始图片中，判断具体标签语义，并更改对应文本标签
   - **整理2-已标记结构树**：一共19个大类的结构数，每个人分到2大类，进行语义近似标签的融合，尽可能地减少相同语义标签数量。**融合标签的时候结构树可视化需要加上食材出现的次数，用于判断该食材出现频次以及重要性。**$\textcolor{red}{结构树可视化融合界面我还没做}$

